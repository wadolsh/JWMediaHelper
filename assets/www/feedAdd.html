<!DOCTYPE html>
<html>
<head>
    <title>Feed Add</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="libs/bootstrap/bootstrap.css" rel="stylesheet" media="screen">
</head>
<body>
<div class="page-header">
    <h1>FEED 정보<small>추가</small></h1>
</div>

<div class="panel">
    <!-- Default panel contents -->
    <div class="panel-heading">취득한 링크</div>
    <p id="link_address"></p>

    <!-- List group -->
    <table class="table table-hover">
        <tr>
            <td rowspan="3"><img src="" id="image" /></td>
            <td>FEED 정보</td>
        </tr>
        <tr>
            <td><small id="title"></small></td>
        </tr>
        <tr>
            <td>언어 <small id="language"></small></td>
        </tr>
        <tr>
            <td colspan="2"><a href="" id="link_href"><small id="link"></small></a></td>
        </tr>
    </table>
    <p>
        <button type="button" id="item1" class="btn btn-primary btn-block">Default button</button>
        <button type="button" id="item2" class="btn btn-default btn-block">Default button</button>
        <button type="button" id="item3" class="btn btn-default btn-block">Default button</button>
    </p>

    <label class="checkbox-inline">
        <input type="checkbox" id="isAutoDownload" value="true"> 신간이 있을 경우 자동 다운로드
    </label>

</div>

<div class="navbar navbar-fixed-bottom">
    <button type="button" class="btn btn-primary btn-large btn-block">전체 다운로드</button>
    <div class="btn-group">
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-ok"></span>저장</button>
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span>삭제</button>
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-share-alt"></span>취소</button>
    </div>
</div>
<script src="libs/jquery.min.js"></script>
<script src="libs/sugar.min.js"></script>
<script src="libs/bootstrap/bootstrap.min.js"></script>

<script type="text/javascript" src="js/cordova-2.7.0.js"></script>
<script type="text/javascript" src="js/webintent.js"></script>
<script type="text/javascript">
var app = {
    init : function() {
        // 이벤트 등록
        document.addEventListener("deviceready", app.start, false);
        document.addEventListener("resume", app.start, false);
    },

    start : function() {
        window.plugins.webintent.getUri(function(url) {
            if(url !== "") {
                app.url = url.replace("itpc", "http");
                $('#link_address').text(app.url);
                app.getFeedInfo(app.url);
            }
        });
    },

    /** 서버로부터 Feed정보 취득 */
    getFeedInfo : function(url) {
        $.get(url,
              function(xml) {
                //app.feedXML = xml;
                //alert(JSON.stringify(xml2Obj(xml)));
                app.feedJSON = xml2Obj(xml).rss.channel;
                $("#image").attr("src", app.feedJSON.image.url);
                $("#title").text(app.feedJSON.title);
                $("#link").text(app.feedJSON.link);
                $("#link_href").attr("href", app.feedJSON.link);
                $("#language").text(app.feedJSON.language);

                $("#item1").text(app.feedJSON.item.title);
                $("#item2").text(app.feedJSON.item.title);
                $("#item3").text(app.feedJSON.item.title);
              },
              "xml");
    },

    resetFeedInfo : function(json) {

    }
}
app.init();


// Changes XML to JSON
function xml2Obj (oXMLNode) {
		    // default value for empty elements; it could be replaced with "null" instead of "true"... but i prefer so, because the truth is what appears :-)
		    var vResult = true;
		    // node attributes
		    if (oXMLNode.attributes && oXMLNode.attributes.length > 0) {
		        var iAttrib;
		        vResult = {};
		        vResult["@attributes"] = {};
		        for (var iAttrId = 0; iAttrId < oXMLNode.attributes.length; iAttrId++) {
		            iAttrib = oXMLNode.attributes.item(iAttrId);
		            vResult["@attributes"][iAttrib.nodeName] = iAttrib.nodeValue;
		        }
		    }
		    // children
		    if (oXMLNode.hasChildNodes()) {
		        var iKey, iValue, iXMLChild;
		        if (vResult === true) { vResult = {}; } // if above you have changed the default value, then it must be also replaced within this "if statement" in the same way...
		        for (var iChild = 0; iChild < oXMLNode.childNodes.length; iChild++) {
		            iXMLChild = oXMLNode.childNodes.item(iChild);
		            if ((iXMLChild.nodeType & 7) === 1) { // nodeType is "Document" (9) or "Element" (1)
		                iKey = iXMLChild.nodeName;
		                iValue = xml2Obj(iXMLChild);
		                if (vResult.hasOwnProperty(iKey)) {
		                    if (vResult[iKey].constructor !== Array) { vResult[iKey] = [vResult[iKey]]; }
		                    vResult[iKey].push(iValue);
		                } else { vResult[iKey] = iValue; }
		            } else if ((iXMLChild.nodeType - 1 | 1) === 3) { // nodeType is "Text" (3) or "CDATASection" (4)
		                iKey = "@content";
		                iValue = iXMLChild.nodeType === 3 ? iXMLChild.nodeValue.replace(/^\s+|\s+$/g, "") : iXMLChild.nodeValue;
		                if (vResult.hasOwnProperty(iKey)) {
		                	vResult[iKey] += iValue;
		                } else if (iXMLChild.nodeType === 4 || iValue !== "") {
		                	vResult = iValue;
		                }
		            }
		        }
		    }
		    return(vResult);
		}

</script>
</body>
</html>

